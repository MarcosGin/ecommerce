{% extends 'layout.twig' %}

{% block container %}
    <div class="containerCentral">
        <div class="products-cont">
            <div class="sidebar right">
                <div class="sidebar-tittle">
                    <span>Categories</span>
                </div>
                <ul class="sidebar-menu">
                </ul>
            </div>
            <div class="list-products left">
                    {% for product in products %}
                        <div class="row">
                            <a href="{{ ('products/profile/' ~ product.nombre) | url }}">
                                <div class="img">
                                    <img src="{{  (product.carpet ~ '/' ~ product.portada)  | url_image }}" alt="img" title="{{ product.nombre }}">
                                </div>
                            </a>

                            <div class="data">
                                <div class="tittle">
                                    <a href="{{ ('products/profile/' ~ product.nombre) | url }}"><span>{{ product.nombre }}</span></a>
                                </div>
                                <div class="price offer">
                                        <span class="base">$ {{ product.precio }}</span>
                                        <span class="with-offer">$ {{ product.precio}}</span>
                                        <span class="value-offer">14 % OFF</span>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts_footer %}
    <script type="text/javascript">
        $(function (){
            var renderCategories = (function () {
                var container = $('.sidebar .sidebar-menu');
                var HTML = '';
                return {
                    init: function () {
                        $.ajax({
                            url: 'http://localhost/ecommerce/public/products/categories',
                            type: 'GET',
                            data: {},
                            contentType: 'application/json; charset=utf-8',
                            datatype: 'json',
                            cache: false
                        }).done(function (data) {
                            if(data.result){
                                HTML += '<li class="active">'+
                                        '<div class="row"><span class="icon"><i class="fa fa-star-o"></i></span><a href="">All</a></div>'+
                                        '</li>';
                                for(var category in data.message){
                                    HTML += '<li class="">'+
                                            '<div class="row">'+
                                            '<span class="icon"><i class="fa ' + data.message[category].icon + '"></i></span>'+
                                            '<a href="">' + data.message[category].name + '</a>'+
                                            '</div><ul class="marks">';
                                     for (var mark in data.message[category].marks){
                                         HTML +=  '<li><a href="">' + data.message[category].marks[mark].name + '</a></li>';
                                     }

                                    HTML += '</ul></li>';
                                }
                                container.empty();
                                container.append(HTML);
                            }
                            console.log(data);
                        }).fail(function (err) {
                            console.log(err);
                        });
                    }
                }
            })();
            renderCategories.init();
        });
    </script>
{% endblock %}